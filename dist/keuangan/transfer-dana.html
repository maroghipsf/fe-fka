<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Dashboard</title><link rel="shortcut icon" href="/assets/compiled/svg/favicon.svg" type="image/x-icon"><link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAiCAYAAADRcLDBAAAEs2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSJ2d78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLnNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLnNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLnNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1zbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjMzIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMzQiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMyIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMzQiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249Ijk2LjAiCiAgIHRpZmY6WVJlc29sdXRpb249Ijk2LjAiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHbob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgMS4xMC4xIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTAzLTMxVDEwOjUwOjIzKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94cGFja2V0Pgpl57uAAAABgmlDQ1BzUkdCIElFQzYxOTY2LTIuMQAAKJF1kc8rRFEUxz9maORHo1hYKC9hISNGTWwsRn4VFmOUX5uZZ36oeTOv954kW2WrKLHxa8FfwFZZK0WkZClrYoOe87ypmWTO7dzzud97z+nec8ETzaiaWd4NWtYyIiNhZWZ2TvE946WZSjqoj6mmPjE1HKWkfdxR5sSbgFOr9Ll/rXoxYapQVik8oOqGJTwqPL5i6Q5vCzeo6dii8KlwpyEXFL519LjLLw6nXP5y2IhGBsFTJ6ykijhexGra0ITl5bRqmWU1fx/nJTWJ7PSUxBbxJkwijBBGYYwhBgnRQ7/MIQIE6ZIVJfK7f/MnyUmuKrPOKgZLpEhj0SnqslRPSEyKnpCRYdXp/9++msneoFu9JgwVT7b91ga+LfjetO3PQ9v+PgLvI1xkC/m5A+h7F32zoLXug38dzi4LWnwHzjeg8UGPGbFfySvuSSbh9QRqZ6H+Gqrm3Z7l9zm+h+iafNUV7O5Bu5z3L/wAdthn7QIme0YAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAJTSURBVFiF7Zi9axRBGIefEw2IdxFBRQsLWUTBaywSK4ubdSGVIY1Y6HZql8ZKCGIqwX/AYLmCgVQKfiDn7jZeEQMWfsSAHAiKqPiB5mIgELWYOW5vzc3O7niHhT/YZvY37/swM/vOzJbIqVq9uQ04CYwCI8AhYAlYAB4Dc7HnrOSJWcoJcBS4ARzQ2F4BZ2LPmTeNuykHwEWgkQGAet9QfiMZjUSt3hwD7psGTWgs9pwH1hC1enMYeA7sKwDxBqjGnvNdZzKZjqmCAKh+U1kmEwi3IEBbIsugnY5avTkEtIAtFhBrQCX2nLVehqyRqFoCAAwBh3WGLAhbgCRIYYinwLolwLqKUwwi9pxV4KUlxKKKUwxC6ZElRCPLYAJxGfhSEOCz6m8HEXvOB2CyIMSk6m8HoXQTmMkJcA2YNTHm3congOvATo3tE3A29pxbpnFzQSiQPcB55IFmFNgFfEQeahaAGZMpsIJIAZWAHcDX2HN+2cT6r39GxmvC9aPNwH5gO1BOPFuBVWAZue0vA9+A12EgjPadnhCuH1WAE8ivYAQ4ohKaagV4gvxi5oG7YSA2vApsCOH60WngKrA3R9IsvQUuhIGY00K4flQG7gHH/mLytB4C42EgfrQb0mV7us8AAMeBS8mGNMR4nwNamtBB7B4QRNdaS0M8GxDEog7iyoAguvJ0QYSBuAOcAt71Kfl7wA8DcTvZ2KtOlJEr+ByyQtqqhTyHTIeB+ONeqi3brh+VgIN0fohUgWGggizZFTplu12yW8iy/YLOGWMpDMTPXnl+Az9vj2HERYqPAAAAAElFTkSuQmCC" type="image/png"><link rel="stylesheet" href="/assets/compiled/css/app.css"><link rel="stylesheet" href="/assets/compiled/css/app-dark.css"><link rel="stylesheet" href="/assets/compiled/css/iconly.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"><script src="https://code.jquery.com/jquery-3.6.0.min.js"></script><link rel="stylesheet" href="/assets/extensions/simple-datatables/style.css"><link rel="stylesheet" href="/assets/compiled/css/table-datatable.css"></head><body><script src="/assets/static/js/initTheme.js"></script><div id="app"><div id="sidebar"><div class="sidebar-wrapper active"><div class="sidebar-header position-relative"><div class="d-flex justify-content-between align-items-center"><div class="logo d-flex align-items-center"><a href="/index.html"><img src="/assets/compiled/svg/logo.svg" alt="Logo"></a></div><!-- Logout icon di pojok kanan --><div><a id="logout-btn" title="Logout" class="d-inline-block"><i class="bi bi-box-arrow-right fs-4"></i></a></div><div class="sidebar-toggler x"><a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a></div></div></div><div class="sidebar-menu"><ul class="menu"><!-- 1. Beranda (Dashboard) --><li class="sidebar-item"><a href="/index.html" class="sidebar-link"><i class="bi bi-house-door"></i> <span>Beranda</span></a></li><!-- 2. Keuangan --><li class="sidebar-title">Keuangan</li><li class="sidebar-item"><a href="/keuangan/ringkasan.html" class="sidebar-link"><i class="bi bi-bar-chart"></i> <span>Ringkasan Keuangan</span></a></li><li class="sidebar-item"><a href="/keuangan/riwayat-transaksi.html" class="sidebar-link"><i class="bi bi-clock-history"></i> <span>Riwayat Transaksi Bank</span></a></li><li class="sidebar-item"><a href="/keuangan/transfer-dana.html" class="sidebar-link"><i class="bi bi-arrow-left-right"></i> <span>Transfer Dana</span></a></li><li class="sidebar-item has-sub"><a href="#" class="sidebar-link"><i class="bi bi-graph-up"></i> <span>Laporan Keuangan</span></a><ul class="submenu"><li class="submenu-item"><a href="/keuangan/laporan-arus-kas.html" class="submenu-link">Laporan Arus Kas</a></li><li class="submenu-item"><a href="/keuangan/laporan-laba-rugi.html" class="submenu-link">Laporan Laba Rugi</a></li><li class="submenu-item"><a href="/keuangan/laporan-pengeluaran-wo.html" class="submenu-link">Laporan Pengeluaran WO</a></li><li class="submenu-item"><a href="/keuangan/laporan-pembayaran-invoice.html" class="submenu-link">Laporan Pembayaran Invoice</a></li></ul></li><!-- 3. Manajemen PO --><li class="sidebar-title">Manajemen PO</li><li class="sidebar-item"><a href="/po/po.html" class="sidebar-link"><i class="bi bi-file-earmark-text"></i> <span>Purchase Order (PO)</span></a></li><!-- <li class="sidebar-item">
                    <a href="/wo/daftar-wo.html" class="sidebar-link">
                        <i class="bi bi-truck"></i>
                        <span>Working Order (WO)</span>
                    </a>
                </li> --><!-- 4. Manajemen Invoice --><li class="sidebar-title">Manajemen Invoice</li><li class="sidebar-item"><a href="/invoice/daftar-invoice.html" class="sidebar-link"><i class="bi bi-receipt"></i> <span>Daftar Invoice</span></a></li><!-- 5. Data Master --><li class="sidebar-title">Data Master</li><li class="sidebar-item"><a href="/master/gudang.html" class="sidebar-link"><i class="bi bi-building"></i> <span>Manajemen Gudang</span></a></li><!-- <li class="sidebar-item">
                    <a href="/master/pemasok.html" class="sidebar-link">
                        <i class="bi bi-person-lines-fill"></i>
                        <span>Manajemen Pemasok</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="/master/item.html" class="sidebar-link">
                        <i class="bi bi-box"></i>
                        <span>Manajemen Item (Barang/Jasa)</span>
                    </a>
                </li> --><li class="sidebar-item"><a href="/master/akun-bank.html" class="sidebar-link"><i class="bi bi-bank"></i> <span>Manajemen Akun Bank</span></a></li><li class="sidebar-item"><a href="/master/manajemen-bunga.html" class="sidebar-link"><i class="bi bi-percent"></i> <span>Manajemen Bunga Bank</span></a></li><!-- 6. Pengaturan & Audit --><li class="sidebar-title">Pengaturan & Audit</li><li class="sidebar-item"><a href="/settings/users.html" class="sidebar-link"><i class="bi bi-people-fill"></i> <span>Manajemen Pengguna</span></a></li><li class="sidebar-item"><a href="/settings/roles.html" class="sidebar-link"><i class="bi bi-shield-lock"></i> <span>Manajemen Peran & Hak Akses</span></a></li><li class="sidebar-item"><a href="/settings/audit-trail.html" class="sidebar-link"><i class="bi bi-activity"></i> <span>Audit Trail</span></a></li><li class="sidebar-item"><a href="/settings/notifikasi.html" class="sidebar-link"><i class="bi bi-bell"></i> <span>Notifikasi</span></a></li></ul></div></div></div><div id="main"><header class="mb-3"><a href="#" class="burger-btn d-block d-xl-none"><i class="bi bi-justify fs-3"></i></a></header><div class="page-heading"><div class="page-title"><div class="row"><div class="col-12 col-md-6 order-md-1 order-last"><h3>Form</h3></div><div class="col-12 col-md-6 order-md-2 order-first"><nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="/index.html">Dashboard</a></li><li class="breadcrumb-item active" aria-current="page">Manajemen Peran & Hak Akses</li></ol></nav></div></div></div><!-- // Basic multiple Column Form section start --><section id="multiple-column-form"><div class="row match-height"><div class="col-12"><div class="card"><div class="card-content"><div class="card-body"><form class="form" id="transferDanaForm" data-parsley-validate><div class="row"><!-- Dari Akun --><div class="col-md-6 col-12"><div class="form-group mandatory"><label for="source_account_id" class="form-label">Dari Akun</label> <select id="source_account_id" name="source_account_id" class="form-select" data-parsley-required="true"><option value="">Pilih Akun Sumber</option></select></div></div><!-- Ke Akun --><div class="col-md-6 col-12"><div class="form-group mandatory"><label for="destination_account_id" class="form-label">Ke Akun</label> <select id="destination_account_id" name="destination_account_id" class="form-select" data-parsley-required="true"><option value="">Pilih Akun Tujuan</option></select></div></div><!-- Jumlah Transfer --><div class="col-md-6 col-12"><div class="form-group mandatory"><label for="amount" class="form-label">Jumlah (Pokok)</label> <input type="number" min="0.01" step="0.01" id="amount" name="amount" class="form-control" data-parsley-required="true" data-parsley-type="number" placeholder="Masukkan jumlah transfer"></div></div><!-- Keterangan --><div class="col-md-6 col-12"><div class="form-group"><label for="description" class="form-label">Keterangan</label> <textarea id="description" name="description" class="form-control" placeholder="Catatan tambahan"></textarea></div></div><!-- Dilakukan Oleh (hidden) --> <input type="hidden" id="created_by" name="created_by"></div><!-- Opsi Bunga (hidden by default) --><div class="row mt-3" id="interest-section" style="display:none; border-top:1px solid #eee;"><div class="col-12"><div class="form-check mt-2"><input class="form-check-input" type="checkbox" id="apply_interest" name="apply_interest"> <label class="form-check-label" for="apply_interest">Terapkan Bunga untuk Transfer ini?</label></div></div><div id="interest-config-fields" style="display:none;"><div class="row"><!-- Konfigurasi Bunga --><div class="col-md-4 col-12 mt-2"><div class="form-group mandatory"><label for="interest_config_id" class="form-label">Pilih Konfigurasi Bunga</label> <select id="interest_config_id" name="interest_config_id" class="form-select"><option value="">Pilih Konfigurasi</option></select></div></div><!-- Tanggal Mulai Bunga --><div class="col-md-4 col-12 mt-2"><div class="form-group mandatory"><label for="interest_start_date" class="form-label">Tanggal Mulai Bunga</label> <input type="date" id="interest_start_date" name="interest_start_date" class="form-control"></div></div><!-- Tanggal Akhir Bunga --><div class="col-md-4 col-12 mt-2"><div class="form-group mandatory"><label for="interest_end_date" class="form-label">Tanggal Akhir Bunga</label> <input type="date" id="interest_end_date" name="interest_end_date" class="form-control"></div></div></div></div></div><div class="row mt-4"><div class="col-12 d-flex justify-content-end"><button type="submit" class="btn btn-primary me-1 mb-1" id="submitBtn">Submit</button> <button type="reset" class="btn btn-light-secondary me-1 mb-1">Reset</button></div></div></form></div></div></div></div></div></section><!-- // Basic multiple Column Form section end --></div><script src="https://code.jquery.com/jquery-3.6.0.min.js"></script><script src="https://cdn.jsdelivr.net/npm/parsleyjs"></script><script>$(function() {
  // 1. Populate akun (Accounts)
  function populateAccounts() {
    $.ajax({
      url: 'http://localhost:3000/api/accounts',
      headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') },
      success: function(res) {
        if (res.data) {
          let options = '<option value="">Pilih Akun</option>';
          res.data.forEach(acc => {
            options += `<option value="${acc.account_id}" data-type="${acc.account_type}">${acc.account_name} (${acc.account_type})</option>`;
          });
          $('#source_account_id').html(options);
          $('#destination_account_id').html(options);
        }
      }
    });
  }
  populateAccounts();

  function formatPersen(val) {
    if (val == null) {
      return '';
    }

    const percentage = parseFloat(val) * 100; // Konversi ke persentase (misal: 0.10 -> 10, 0.0125 -> 1.25)

    // Periksa apakah angka hasil persentase adalah bilangan bulat (tidak ada sisa desimal)
    if (percentage % 1 === 0) {
      // Jika bilangan bulat (misal: 10.00), gunakan toFixed(0) untuk menghilangkan desimal
      return percentage.toFixed(0) + ' %';
    } else {
      // Jika ada desimal (misal: 1.25), gunakan toFixed(2) untuk membulatkan ke dua angka desimal
      return percentage.toFixed(2) + ' %';
    }
  }
  // Populate konfigurasi bunga dari endpoint interest-configs
  function populateInterestConfigs() {
    $.ajax({
      url: 'http://localhost:3000/api/interest-configs?is_active=1',
      headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') },
      success: function(res) {
        if (res.data) {
          let options = '<option value="">Pilih Konfigurasi</option>';
          res.data.forEach(cfg => {
            options += `<option value="${cfg.interest_config_id}">${cfg.config_name} (${formatPersen(cfg.rate_percentage)} - ${cfg.calculation_type})</option>`;
          });
          $('#interest_config_id').html(options);
        }
      }
    });
  }
  populateInterestConfigs();

  // 3. Filter akun tujuan agar tidak sama dengan sumber
  $('#source_account_id').on('change', function() {
    let sourceVal = $(this).val();
    $('#destination_account_id option').show();
    if (sourceVal) {
      $('#destination_account_id option[value="' + sourceVal + '"]').hide();
    }
    // Cek apakah perlu tampilkan bunga
    let srcType = $('#source_account_id option:selected').data('type');
    let dstType = $('#destination_account_id option:selected').data('type');
    toggleInterestSection(srcType, dstType);
  });

  $('#destination_account_id').on('change', function() {
    let srcType = $('#source_account_id option:selected').data('type');
    let dstType = $('#destination_account_id option:selected').data('type');
    toggleInterestSection(srcType, dstType);
  });

  // 4. Tampilkan/Hide section bunga
  function toggleInterestSection(srcType, dstType) {
    if (srcType === 'Modal' && dstType === 'Operasional') {
      $('#interest-section').show();
    } else {
      $('#interest-section').hide();
      $('#apply_interest').prop('checked', false);
      $('#interest-config-fields').hide();
      // Reset field bunga
      $('#interest_config_id').val('');
      $('#interest_start_date').val('');
      $('#interest_end_date').val('');
    }
  }

  // 5. Checkbox bunga
  $('#apply_interest').on('change', function() {
    if ($(this).is(':checked')) {
      $('#interest-config-fields').show();
      $('#interest_config_id').attr('data-parsley-required', 'true');
      $('#interest_start_date').attr('data-parsley-required', 'true');
      $('#interest_end_date').attr('data-parsley-required', 'true');
    } else {
      $('#interest-config-fields').hide();
      $('#interest_config_id').removeAttr('data-parsley-required');
      $('#interest_start_date').removeAttr('data-parsley-required');
      $('#interest_end_date').removeAttr('data-parsley-required');
      $('#interest_config_id').val('');
      $('#interest_start_date').val('');
      $('#interest_end_date').val('');
    }
  });

  // 6. Set created_by dari user login (misal user_id disimpan di localStorage)
  $('#created_by').val(localStorage.getItem('user_id') || '435c849a-8dd2-4724-bf4d-b0293f79fd56');

  // 7. Submit form
  $('#transferDanaForm').on('submit', function(e) {
    e.preventDefault();
    var form = $(this);

    if (!form.parsley().isValid()) {
      form.parsley().validate();
      return;
    }

    // Build payload sesuai backend
    var payload = {
      source_account_id: $('#source_account_id').val(),
      destination_account_id: $('#destination_account_id').val(),
      amount: parseFloat($('#amount').val()),
      description: $('#description').val(),
      created_by: $('#created_by').val()
    };
    
    // Jika bunga diterapkan, tambahkan field bunga ke root payload
    if ($('#interest-section').is(':visible') && $('#apply_interest').is(':checked')) {
      payload.apply_interest = true;
      payload.interest_config_id = $('#interest_config_id').val();
      payload.interest_start_date = $('#interest_start_date').val();
      payload.interest_end_date = $('#interest_end_date').val();
    } else {
      payload.apply_interest = false;
    }

    $.ajax({
      url: 'http://localhost:3000/api/transactions/transfer',
      type: 'POST',
      contentType: 'application/json',
      headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') },
      data: JSON.stringify(payload),
      success: function(res) {
        Swal.fire({
          icon: 'success',
          title: 'Sukses',
          text: 'Transfer dana berhasil!',
          timer: 1500,
          showConfirmButton: false
        }).then(() => {
          location.reload();
        });
      },
      error: function(xhr) {
        Swal.fire({
          icon: 'error',
          title: 'Gagal',
          text: xhr.responseJSON?.message || xhr.statusText
        });
      }
    });
  });
});</script><div class="page-heading"><div class="page-title"><div class="row"><div class="col-12 col-md-6 order-md-1 order-last"><h3>List Transfer Dana</h3></div></div></div><section class="section"><div class="card"><div class="card-body"><table class="table table-striped" id="table1"><thead><tr><th>Tanggal</th><th>Dari Akun</th><th>Ke Akun</th><th>Jumlah</th><th>Keterangan</th><th>Status</th><th>Action</th></tr></thead><tbody id="transfer-table-body"><!-- Data will be populated here by JavaScript --></tbody></table></div></div></section></div><!-- Modal Detail Transfer Dana --><div class="modal fade" id="modalDetailTransfer" tabindex="-1" aria-labelledby="modalDetailTransferLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title" id="modalDetailTransferLabel"><i class="bi bi-info-circle me-2"></i>Detail Transfer Dana</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><dl class="row mb-0"><dt class="col-sm-4">Tanggal Transfer</dt><dd class="col-sm-8" id="detail-transfer-date"></dd><dt class="col-sm-4">Dari Akun</dt><dd class="col-sm-8" id="detail-source-account"></dd><dt class="col-sm-4">Ke Akun</dt><dd class="col-sm-8" id="detail-destination-account"></dd><dt class="col-sm-4">Jumlah</dt><dd class="col-sm-8 fw-bold text-success" id="detail-amount"></dd><dt class="col-sm-4">Keterangan</dt><dd class="col-sm-8" id="detail-description"></dd><dt class="col-sm-4">Status</dt><dd class="col-sm-8" id="detail-status"></dd><dt class="col-sm-4">Dibuat Oleh</dt><dd class="col-sm-8" id="detail-created-by"></dd></dl><hr><div id="detail-interest-section" style="display:none;"><h6 class="mb-3"><i class="bi bi-percent me-2"></i>Detail Bunga Transfer</h6><dl class="row mb-0"><dt class="col-sm-4">Konfigurasi Bunga</dt><dd class="col-sm-8" id="detail-interest-config"></dd><dt class="col-sm-4">Tanggal Mulai</dt><dd class="col-sm-8" id="detail-interest-start"></dd><dt class="col-sm-4">Tanggal Akhir</dt><dd class="col-sm-8" id="detail-interest-end"></dd><dt class="col-sm-4">Rate</dt><dd class="col-sm-8" id="detail-interest-rate"></dd><dt class="col-sm-4">Jenis Perhitungan</dt><dd class="col-sm-8" id="detail-interest-type"></dd><dt class="col-sm-4">Jumlah Bunga</dt><dd class="col-sm-8 fw-bold text-danger" id="detail-interest-amount"></dd></dl></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x"></i> Tutup</button></div></div></div></div><script>function formatRupiah(angka) {
  return 'Rp ' + angka.toLocaleString('id-ID');
}

fetch('http://localhost:3000/api/transactions', {
    headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
})
  .then(response => response.json())
  .then(result => {
    const tbody = document.getElementById('transfer-table-body');
    tbody.innerHTML = '';
    if (!result.data || result.data.length === 0) {
      tbody.innerHTML = `<tr><td colspan="7">Data tidak ditemukan</td></tr>`;
    } else {
      result.data.forEach(trx => {
        tbody.innerHTML += `
          <tr>
            <td>${trx.transfer_date ? trx.transfer_date.substr(0,10) : ''}</td>
            <td>${trx.source_account_name || ''}</td>
            <td>${trx.destination_account_name || ''}</td>
            <td>${trx.amount != null ? formatRupiah(Number(trx.amount)) : ''}</td>
            <td>${trx.description || ''}</td>
            <td>
              <span class="badge bg-${trx.status === 'success' ? 'success' : 'secondary'}">
                ${trx.status === 'success' ? 'Sukses' : 'Draft'}
              </span>
            </td>
            <td>
              <button class="btn btn-sm btn-primary" title="Detail" onclick="detailTransfer('${trx.transfer_id}')">
                <i class="bi bi-eye"></i>
              </button>
              <button class="btn btn-sm btn-danger" title="Delete" onclick="deleteTransfer('${trx.transfer_id}')">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        `;
      });
    }
  })
  .catch(err => {
    document.getElementById('transfer-table-body').innerHTML =
      `<tr><td colspan="7">Gagal memuat data</td></tr>`;
  });

// Detail transfer function (implementasi sesuai kebutuhan)
function detailTransfer(id) {
  fetch(`http://localhost:3000/api/transactions/${id}`, {
    headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
  })
    .then(response => response.json())
    .then(res => {
      if (res.data) {
        const trx = res.data;
        $('#detail-transfer-date').text(trx.transfer_date ? trx.transfer_date.substr(0,10) : '-');
        $('#detail-source-account').text(trx.source_account_name || '-');
        $('#detail-destination-account').text(trx.destination_account_name || '-');
        $('#detail-amount').text(trx.amount != null ? formatRupiah(Number(trx.amount)) : '-');
        $('#detail-description').text(trx.description || '-');
        $('#detail-status').html(
          trx.status === 'success'
            ? '<span class="badge bg-success">Sukses</span>'
            : '<span class="badge bg-secondary">Draft</span>'
        );
        $('#detail-created-by').text(trx.created_by_name || '-');

        // Bunga (jika ada)
        if (trx.interest_config_name) {
          $('#detail-interest-section').show();
          $('#detail-interest-config').text(trx.interest_config_name || '-');
          $('#detail-interest-start').text(trx.interest_start_date || '-');
          $('#detail-interest-end').text(trx.interest_end_date || '-');
          $('#detail-interest-rate').text(trx.interest_rate_percentage != null ? formatPersen(trx.interest_rate_percentage) : '-');
          $('#detail-interest-type').text(trx.interest_calculation_type || '-');
          $('#detail-interest-amount').text(trx.interest_amount != null ? formatRupiah(Number(trx.interest_amount)) : '-');
        } else {
          $('#detail-interest-section').hide();
        }

        // Tampilkan modal
        var modal = new bootstrap.Modal(document.getElementById('modalDetailTransfer'));
        modal.show();
      }
    });
}

// Delete transfer function
function deleteTransfer(id) {
  Swal.fire({
    title: 'Yakin hapus data ini?',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Ya, hapus!',
    cancelButtonText: 'Batal'
  }).then((result) => {
    if (result.isConfirmed) {
      fetch(`http://localhost:3000/api/transfer-funds/${id}`, {
        method: 'DELETE',
        headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
      })
      .then(response => response.json())
      .then(res => {
        if (res.status === 'success') {
          Swal.fire({
            icon: 'success',
            title: 'Sukses',
            text: 'Data berhasil dihapus!',
            timer: 1500,
            showConfirmButton: false
          }).then(() => {
            location.reload();
          });
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Gagal',
            text: res.message || 'Data gagal dihapus.'
          });
        }
      })
      .catch(() => {
        Swal.fire({
          icon: 'error',
          title: 'Gagal',
          text: 'Terjadi kesalahan saat menghapus data.'
        });
      });
    }
  });
}

function formatPersen(val) {
  if (val == null) {
    return '';
  }

  const percentage = parseFloat(val) * 100; // Konversi ke persentase (misal: 0.10 -> 10, 0.0125 -> 1.25)

  // Periksa apakah angka hasil persentase adalah bilangan bulat (tidak ada sisa desimal)
  if (percentage % 1 === 0) {
    // Jika bilangan bulat (misal: 10.00), gunakan toFixed(0) untuk menghilangkan desimal
    return percentage.toFixed(0) + ' %';
  } else {
    // Jika ada desimal (misal: 1.25), gunakan toFixed(2) untuk membulatkan ke dua angka desimal
    return percentage.toFixed(2) + ' %';
  }
}</script><footer><div class="footer clearfix mb-0 text-muted"><div class="float-start"><p>2023 &copy; Mazer</p></div><div class="float-end"><p>Crafted with <span class="text-danger"><i class="bi bi-heart-fill icon-mid"></i></span> by <a href="https://saugi.me">Saugi</a></p></div></div></footer></div></div><script src="/assets/static/js/components/dark.js"></script><script src="/assets/extensions/perfect-scrollbar/perfect-scrollbar.min.js"></script><script src="/assets/compiled/js/app.js"></script><script src="/assets/static/js/auth-guard.js"></script><script>$(document).on('click', '#logout-btn', function(e) {
    e.preventDefault();
    localStorage.removeItem('token');
    window.location.href = '/auth-login.html';
  });</script><script src="/assets/static/js/pages/form-element-select.js"></script><script src="/assets/extensions/simple-datatables/umd/simple-datatables.js"></script><script src="/assets/static/js/pages/simple-datatables.js"></script><script src="/assets/extensions/jquery/jquery.min.js"></script><script src="/assets/extensions/parsleyjs/parsley.min.js"></script><script src="/assets/static/js/pages/parsley.js"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script></body></html>